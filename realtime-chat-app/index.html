<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChitChat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <!-- google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Anton&family=Bowlby+One+SC&family=Castoro+Titling&family=Edu+QLD+Hand:wght@400..700&family=Finger+Paint&family=Fredericka+the+Great&family=Great+Vibes&family=Inter+Tight:ital,wght@0,100..900;1,100..900&family=Kaushan+Script&family=PT+Serif:ital,wght@0,400;0,700;1,400;1,700&family=Pacifico&family=Playfair+Display+SC:ital,wght@0,400;0,700;0,900;1,400;1,700;1,900&family=Protest+Revolution&family=Raleway:ital,wght@0,100..900;1,100..900&family=Special+Gothic+Expanded+One&family=Titan+One&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="container-fluid chat-container mt-5">
        <h2 class="text-center logo display-4">ChitChatðŸ’Œ</h2>

        <div class="mb-3">
            <input type="text" class="form-control form-control-lg" id="myname" placeholder="Enter your name">
        </div>

        <div class="messageArea" id="messageArea"></div>

        <form id="form" class="chat-input input-group   mt-3">
            <input type="text" class="form-control" id="message" placeholder="Type your message...">
            <button class="btn btn-success" type="submit">
                <i class="bi bi-send-fill"></i>
            </button>
        </form>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket = io();
        let form = document.getElementById('form');
        let myname = document.getElementById('myname');
        let message = document.getElementById('message');
        let messageArea = document.getElementById('messageArea');

        socket.on('connect', () => {
            console.log("Connected to server");
        });

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            if (message.value.trim()) {
                let data = {
                    user: myname.value || "Anonymous",
                    text: message.value,
                    time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                };
                console.log("Sending:", data);
                socket.emit('chat', data);
                message.value = '';
            }
        });

        socket.on('chat', (data) => {
            console.log("Received:", data);
            let wrapper = document.createElement('div');
            wrapper.classList.add('d-flex', 'mb-2');

            let msgBubble = document.createElement('div');
            msgBubble.classList.add('msg-bubble');

            if (data.user === (myname.value || "Anonymous")) {
                wrapper.classList.add('justify-content-end');
                msgBubble.classList.add('sent');
                msgBubble.innerHTML = `
          <span class="text">${data.text}</span>
          <div class="time">${data.time}</div>`;
            } else {
                wrapper.classList.add('justify-content-start');
                msgBubble.classList.add('received');
                msgBubble.innerHTML = `
          <small class="fw-bold d-block">${data.user}</small>
          <span class="text">${data.text}</span>
          <div class="time">${data.time}</div>`;
            }

            wrapper.appendChild(msgBubble);
            messageArea.appendChild(wrapper);
            messageArea.scrollTop = messageArea.scrollHeight;
        });
    </script>
</body>

</html>